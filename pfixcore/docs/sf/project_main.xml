<div>
  <h1>Project definition</h1>
  <p>For each project in your <pustefix/> environment you need to create a definition file that contains all the
    information about your project that is needed to automatically generate other configuration files for various sbsystems.</p>
  <ul>
    <li>The <b>apache</b> config file, containing the definition for each of the projects of your environment:<br/>
      <code>servletconf/tomcat/apache.conf</code></li>
    <li>The config files for <b>mod_jk</b>:<br/>
      <code>servletconf/tomcat/jk.conf</code> and <code>servletconf/tomcat/workers.prop</code>.
    </li>
    <li>The config file for the <b>tomcat</b> servlet container:<br/>
      <code>servletconf/tomcat/conf/server.xml</code></li>
    <li>The config files for every <b>webapp</b> (each project is mapped to a webapp):<br/>
      <code>servletconf/tomcat/webapps/[project name]/WEB-INF/web.xml</code>
    </li>
  </ul>

  <p>This information is contained in a site wide file
    <code>servletconf/projects.xml.in</code> which contains information
    every environment needs. Each project also needs to supply a file to tell the
    system it's own configuration. These files are at <code>[project
      name]/conf/project.xml.in</code>. All those files, together with the
    site wide file are used as the source for creating the above
    mentioned config files.
  </p>

  <h2>The site wide configuration <i>servletconf/projects.xml.in</i></h2>

  <p>The site wide projects.xml.in file contains two "projects" that are
    needed for <pustefix/> itself to work properly.  The first of these
    is the <a href="editor.html">editor</a> project. The other project
    is used to start a servlet automatically when the system
    starts. This servlet itself is not able to act on any userinput,
    it's only purpose is to start a bunch of factories that implement
    functionality shared by other, "real" projects.</p>
  
  <p>If you need other servlets for administrative purposes (e.g. to
    gather some sort of statisitics about the system as a whole) you can
    add these servlets to this project.</p>
  
  <h2>The project specific configuration <i>[project name]/conf/project.xml.in</i></h2>

  <p>

    <xmlcode>
      <project name="test" xmlns:cus="http://www.schlund.de/pustefix/customize">
        <active>true</active>
        <comment>Test Application</comment>
        <xmlcodeOFF>
          <div class="comment">
            The content of this tag is used in the <a href="editor.html">editor</a> to list all defined projects.</div>
        </xmlcodeOFF>
        <depend><cus:docroot/>MyProject/conf/depend.xml</depend>
        <xmlcodeOFF>
	  <div class="comment">
	    The location of the depend file must be specified for the <a href="editor.html">editor</a>.</div><br/>
	  <div class="comment" style="border: 1px red solid; background: #eeaaaa;">
	    <b>This section is for generating apache.conf in the
	      servletconf/tomcat directory.</b>
	    <div>
	      <xmlcode>
		<xmlcodeINV>
		  <virtualhost>SomeVirtualHostName</virtualhost>
		  <servername>SomeServerName</servername>
		  <serveralias>SomeServerAlias</serveralias>
		  <defpath>/xml/SomeDefinedServlet</defpath>
		  <xmlcodeOFF>
		    <div class="comment">
		      The defpath tag names a default servlet if the user didn't specify one 
		      explicitly in the url (the "xml" part is the mount point of the ServletContext
                      in which all servlets are running)
		    </div>
		  </xmlcodeOFF>
		  <documentroot>/Path/To/DocumentRoot</documentroot>
		  <xmlcodeOFF>
		    <div class="comment">
		      The apache DocumentRoot for static content, e.g. html pages or pdf
		      files. Required because otherwise apache uses its default DocumentRoot which
		      may not be desirable from a security point of view. If you don't have any
		      static content to server. you can use an empty directoy
		    </div>
		  </xmlcodeOFF>
		  <passthrough>MyProject/img</passthrough>
		  <xmlcodeOFF>
		    <div class="comment">
		      Specify directories which shall not be relative to the DocumentRoot
		      here. This is used for directories containing images, as they are served by
		      apache directly.
		    </div>
		  </xmlcodeOFF>
		  <literalapache>
		    <xmlcodeOFF>
		      <div class="comment">
			Enter arbitrary additional stuff for the apache.conf file here. 
		      </div>
		    </xmlcodeOFF>
		  </literalapache>
		  <ports>
		    <port number="80"/>
		    <port number="443" ssl="true">
		      <sslkey>/etc/httpd/conf/ssl.key/server.key</sslkey>
		      <sslcrt>/etc/httpd/conf/ssl.crt/server.crt</sslcrt>
		    </port>
		    <xmlcodeOFF>
		      <div class="comment">
			If you don't want to use SSL, you can remove the SSL 
			section.
		      </div>
		    </xmlcodeOFF>
		  </ports>
		</xmlcodeINV>
	      </xmlcode>
	    </div>
	  </div>
        </xmlcodeOFF>

        <xmlcodeOFF>
	  <div class="comment">
	    Specify at least one servlet here. Create a config file for every servlet you define, as described 
	    <a href="prop.html#single">here</a>. 
	  </div>
        </xmlcodeOFF>

        <servlet name="myservlet" useineditor="true">
	  <xmlcodeOFF>
	    <table class="stdtable">
	      <tr>
	        <th>Attribute</th>
	        <th>Notes</th>
	      </tr>
	      <tr>
	        <td>useineditor</td>
	        <td>set to true for every servlet that handles pages belonging directly to the project
	          (That means for example not the servlet that starts up the <a href="editor.html">editor</a>, as the pages delivered
	          by this servlet belong to the <a href="editor.html">editor</a> project)
	        </td>
	      </tr>
	    </table>
	  </xmlcodeOFF>

	  <active>true</active>
	  <class>de.schlund.pfixxml.ContextXMLServer</class>
	  <xmlcodeOFF>
	    <div class="comment">
	      All project-specific servlets that produce pages from a XSLT transformation are usually
	      instances of the <code>ContextXMLServer</code> class.
	    </div>
	  </xmlcodeOFF>
	  
	  <propfile><cus:docroot/>MyProject/conf/myservlet.prop</propfile>
	  <xmlcodeOFF>
	    <div class="comment">
	      By convention, the properties file for a servlet resides
	      in <code>MyProject/conf/</code> and is named
	      <code>myservlet.prop</code>, where "myservlet" stands for the actual name of the
	      servlet. Note that the actual file you have to create is <code>myservlet.prop.in</code>,
	      the build system takes care to produce the final property file from your configuration.
	    </div>
	  </xmlcodeOFF>
        </servlet>
        
        <xmlcodeOFF>
	  <div class="comment">
	    The edit and deref servlets must always be present. The <code>edit</code> servlet is the
	    Pustefix CMS, and the <code>deref</code> servlet is used to create links to external
	    websites without transmitting Referer-headers which may contain the private session id.
            You don't need to create config files for these.
	  </div>
        </xmlcodeOFF>
        
        <servlet name="edit">
	  <active>true</active>
	  <class>de.schlund.pfixxml.ContextXMLServer</class>
	  <propfile><cus:docroot/>core/editor/conf/config.prop</propfile>
        </servlet>
        <servlet name="deref">
	  <active>true</active>
	  <class>de.schlund.pfixxml.DerefServer</class>
        </servlet>
      </project>
    </xmlcode>

  </p>
  
</div>
