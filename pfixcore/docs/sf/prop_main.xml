<div xmlns:cus="http://www.schlund.de/pustefix/customize">

  <h1>Property files in <pustefix/></h1>

  <h2>Overview</h2>

  <p>The configuration of the Java part of the framework (which
    encompasses all the servlets and other services used by the application) is done
    with standard java property files. Those property files are not
    edited directly, but instead property source files (with the extension
    <code>.prop.in</code>) are used. These files use XML tags to
    describe properties. Additionally a customization mechanism is
    provided that helps to configure the configuration files according
    to local needs.</p>

  <p>The general structure of a <code>.prop.in</code> file is very easy:</p>
  
  <xmlcode>
    <properties>
      <xmlcodeNS ns="cus">http://www.schlund.de/pustefix/customize</xmlcodeNS>
      <xmlcodeOFF>
        <div class="comment">
          The <code>cus</code> namespace is needed to use the customization tags explained below.
        </div>
      </xmlcodeOFF>
      <prop name="statuscodefactory.messagefile">common/dyntxt/statusmessages.xml</prop>
      <xmlcodeOFF>
        <div class="comment">
          The <code>prop</code> tag is the most primitive way to enter a single property.
          The example above would simply result in the java property<br/><br/>
          <code>statuscodefactory.messagefile=common/dyntxt/statusmessages.xml</code><br/>
        </div>
      </xmlcodeOFF>
    </properties>
  </xmlcode>

  <p><pustefix/> allows to customize the creation of the property files in certain ways. When the build system
  starts the transformation of the <code>.prop.in</code> files to <code>.prop</code> files, it supplies certain parameters
  to the transforming stylesheet.</p>

  <ul>
    <li>
      The value of the <b>MAKE_MODE</b> environment variable, or
      "<b>test</b>" if the variable is not set (the default behaviour
      can be changed by tweaking the makefiles). This can be used to
      easily switch preferences depending on the "mode" that is active
      when the application is made, e.g. "test" on the development
      machines, and "prod" on the production servers. The value is supplied as the parameter <code>mode</code>.</li>
    
    <li>The <code>docroot</code>, i.e. the directory where your project's configuration and XML/XSLT files are located in.</li>

    <li>The user id (<code>uid</code>) of the user that starts the build process.</li>

    <li>The full qualified domainname (as the parameter <code>fqdn</code> of the machine you start the build process.</li>

    <li>and the name  of the machine (<code>machine</code>) you start the build process on.</li> 
  </ul>

  <p>Certain customization tags work with these parameters:</p>

  <xmlcode>
    <properties>
      <prop name="foo"><cus:docroot/>/bar/baz.xml</prop>
      <xmlcodeOFF>
        <div class="comment">
          <p>Use this to enter pathnames that do not depend on
            the absolute location of the <pustefix/> environment in your filesystem.</p>
          <p>In the same way you can use <code>cus:machine</code>, <code>cus:fqdn</code> and <code>cus:uid</code>
            to print out the value of the supplied XSLT parameter.</p>
        </div>
      </xmlcodeOFF>
      <cus:choose>
        <cus:test mode="test">
          <xmlcodeOFF/>
        </cus:test>
        <cus:test uid="pfixuser">
          <xmlcodeOFF/>
        </cus:test>
        <cus:test machine="server1">
          <xmlcodeOFF>
            <div class="comment">
              <p>These three <code>cus:test</code> nodes above test for one of the supplied XSLT parameters...</p>
            </div>
          </xmlcodeOFF>
        </cus:test>
        <cus:test mode="prod" uid="pfixuser">
          <xmlcodeOFF/>
        </cus:test>
        <cus:test bool="or" mode="prod" machine="server1">
          <xmlcodeOFF>
            <div class="comment">
              <p>...while these two test for a combination of variables. Default for the test to pass is when <b>ALL</b>
                of the supplied XSLT parameters match the attribute values supplied. If you set the attribute <code>bool</code> to
                <code>or</code> instead, <b>ANY</b> matching parameter will let the complete test pass.</p>
            </div>
          </xmlcodeOFF>
        </cus:test>
        <cus:test>
          <xmlcodeOFF>
            <div class="comment">
              <p>The "default test" that will always pass.</p>
            </div>
          </xmlcodeOFF>
        </cus:test>
      </cus:choose>
    </properties>
  </xmlcode>

  <p>Several property files in <pustefix/> are contructed this way. While
    the <code>prop</code> tag would be sufficant to enter every java
    property, there are convenience tags defined for the configuration
    of the most often used servlets (see below).</p>
  <p>
    The table lists the property files that are used in a typical <pustefix/> system.
  </p>

  <table class="stdtable">
    <tr>
      <th>Propertyfile</th>
      <th>Description</th>
    </tr>
    <tr>
      <td>
        <code>DOCROOT/common/conf/pustefix.prop.in</code>
      </td>
      <td>
        This is a file with common properties shared between all
        running servlets.  Properties set in this file can be
        overwritten by the servlet's specific property file.  A
        typical common property file looks similar to the one supplied
        with the skeleton application or the CVS checkout.
      </td>
    </tr>
    <tr>
      <td>
        <code>DOCROOT/MyProject/conf/*.prop.in</code>
      </td>
      <td>
        <p>The <code>conf</code> subdirectory of a project holds the
        servlet specific property files. These files describe
        among other things the mapping between <i>pages</i> and the
          <i>business logic</i> that handles them. Please read
          below for a detailed description of the property file syntax
          for the most common case of a <code>de.schlund.pfixxml.ContextXMLServer</code> servlet.
        </p>
        <p>The set of properties for a
          servlet is constructed in the following way: The common
          porperty file <code>pustefix.prop</code> is read, the the
          servlet specific property file is merged into the property
          object. This way it is possible to override properties
          defined in the common file with properties defined in the
          specific property file.
        </p>
      </td>
    </tr>
    <tr>
      <td>
        <code>DOCROOT/common/conf/factory.prop.in</code>
      </td>
      <td>
        <p>
          This property file is used for the special project
          <b>admcore</b>. This project is active in every pustefix
          environment and automatically starts a
          <code>de.schlund.pfixxml.FactoryInitServlet</code> servlet
          whenever the servletcontainer starts up to initalize
          services that are used by all the other projects.
        </p>
      </td>
    </tr>
  </table>
  
  <h1>Servlet propery files</h1>

  <h2>de.schlund.pfixxml.ContextXMLServer</h2>

  <h2>de.schlund.pfixxml.DirectOutputServlet</h2>

  
</div>