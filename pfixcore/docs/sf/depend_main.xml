<div>
  <h1>The depend.xml.in file</h1>

  <p>
    The <code>depend.xml</code> configuration file serves two
    purposes: First, it is used to create the <i>hierarchical page
    structure</i> of the project by defining a <i>tree of pages</i>.
    Then, it is used to define the internal structure of the pages by
    defining, for every single page, the <i>tree of transformations</i>
    that need to be applied to certain files to get the final
    stylesheet (which is the representation of the page in
    <pustefix/>). For an overview over the transformation aspect of
    the whole framework, please go <a href="xml.html">here</a>.
  </p>

  <p>To make life a little easier, you never edit the <code>depend.xml</code> file directly,
    but instead a <code>depend.xml.in</code> file which is used to
    produce the <code>depend.xml</code> file (this is done
    automatically by the build system of the skeleton package and the
    CVS checkout).
  </p>
  
  <p>The structure of the config file is show below:
  </p>
  
  <xmlcode>
    <make cachedir="..." recorddir="...">
      <xmlcodeOFF>
        <table class="stdtable">
          <tr>
            <th>Attribute</th>
            <th>Notes</th>
          </tr>
          <tr>
            <td>cachedir</td>
            <td>
              <p>This attribute designates a directory where the generated stylesheets are saved to.</p>
              <p>NOTE: The attribute is <b>mandatory</b>; you must give a path relative to the <b>docroot</b> here!</p>
            </td>
          </tr>
          <tr>
            <td>record_dir</td>
            <td>
              <p>This attribute designates the directory that is used
              to save recorded trails to (see the documentation for
              the <a href="testclient.html">testclient</a> to learn
              more about the use of this attribute).</p> <p>NOTE: The
              attribute is <b>optional</b>, if given, it must be
              either an absolute path name or a relative path which is
              interpreted as being relative to the <b>docroot</b></p>
            </td>
          </tr>
        </table>
      </xmlcodeOFF>
      <navigation>
        <xmlcodeOFF>
          <div class="comment">
            This tag has only <code>page</code> nodes as
            children. The tree of pages matches the hierarchy of the
            project's sitetree.</div>
        </xmlcodeOFF>
        <page name="foo" handler="/xml/static">
          <page name="sub_foo1" handler="/xml/static"/>
          <page name="sub_foo2" handler="/xml/static"/>
          ...
        </page>
        <page name="bar" handler="/xml/config">
          ...
        </page>
        ...
        <xmlcodeOFF>
          <table class="stdtable">
            <tr>
              <th>Attribute</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>
                name
              </td>
              <td>
                <p>
                  The name of the page. This name is used throughout
                  <pustefix/> to reference the page (e.g. when creating
                  internal links and in other config files).
                </p>
                <p>
                  NOTE: This attribute is <b>mandatory</b>
                </p>
              </td>
            </tr>
            <tr>
              <td>
                handler
              </td>
              <td>
                <p>This attribute tells the system which servlet is
                  used to handle requests for this page. You can think
                  of the <code>handler</code> attribute as a project wide servlet "name" 
                  as defined in the <a href="project.html">project definition</a></p>
                <p>
                  NOTE: This attribute is <b>mandatory</b>
                </p>
              </td>
            </tr>
          </table>
        </xmlcodeOFF>

        <target name="a_target_name.xsl"       type="[xsl|xml]">...</target>
        <target name="another_target_name.xml" type="[xsl|xml]">...</target>
        ...
        <standardpage name="a_page_name"       xml="a_base_xml_file.xml">...</standardpage>
        <standardpage name="another_page_name" xml="a_base_xml_file.xml">...</standardpage>
        ...
        <xmlcodeOFF>
          <div class="comment">
            <p>The only other tags allowed besides the
              <code>navigation</code> tag are <code>target</code>
              and <code>standardpage</code>. <b>The latter is only a
                convenience tag that can be expressed fully in terms
                of <code>target</code> tags</b> (Expanding the
              <code>standardpage</code> tag is one of the duties
              of the transformation [<code>depend.xml.in</code>
              => <code>depend.xml</code>] mentioned above).</p>
            <p> See below for a detailed explanation of targets and their configuration</p>
          </div>
        </xmlcodeOFF>
      </navigation>
    </make>
  </xmlcode>

  <h2>Targets</h2>

  <xmlcode>
    <target name="master.xsl" type="xsl">
      <xmlcodeOFF>
        <table class="stdtable">
          <tr>
            <th>
              Attribute
            </th>
            <th>
              Notes
            </th>
          </tr>
          <tr>
            <td>
              name
            </td>
            <td>
              The name of the target. This name must be unique for the whole project (NOT the whole environment!)
            </td>
          </tr>
          <tr>
            <td>
              type
            </td>
            <td>
              Must be <b>xsl</b> for a target that should be "compiled" into a templates object. Must be <b>xml</b> for every
              target that is used as input for a transformation.
            </td>
          </tr>
        </table>
      </xmlcodeOFF>
      <depxml name="core/xsl/master.xsl"/>
      <depxsl name="core/editor/xsl/custommaster.xsl"/>
      <xmlcodeOFF>
        <div class="comment">
          <code>depxml</code> and <code>depxsl</code> reference other
          targets by their <code>name</code> attribute that serve as
          the XML resp. XSL input used to create this target via a XSL
          transformation. If for a given <code>name</code> attribute of either
          <code>depxml</code> or <code>depxsl</code> no other target definition is found,
          the transformation parent is supposed to be a leaf target and the <code>name</code> attribute
          is interpreted as a path relative to the docroot.
        </div>
      </xmlcodeOFF>
      <depaux name="core/xsl/default_copy.xsl"/>
      <depaux name="core/xsl/include.xsl"/>
      <depaux name="core/xsl/navigation.xsl"/>
      <depaux name="core/xsl/utils.xsl"/>
      <depaux name="core/xsl/forminput.xsl"/>
      <xmlcodeOFF>
        <div class="comment">
          <p>
            <code>depaux</code> tags create user defined dependencies on
            the files they reference in their <code>name</code>
            attribute. Whenever the target generation system is asked
            for a target, all its dependencies are checked whether their
            modification time is older than the creation time of the
            target. Dependencies include by design the
            <code>depxml</code> and <code>depxsl</code> targets (which
            may be files in the case of a leaf target or another
            virtual target that returns its own creation time as the modification time) and all
            include files from which include parts are taken during
            the transformation of the target.
          </p>
          <p>
            If any of these files or targets has been changed after
            the target was built, it is taken care of that the target
            is rebuild.
          </p>
          <p>
            <code>depaux</code> just adds more dependencies
            that are not automatically detected "by hand". In the example
            above, the files referenced are XSLT stylesheets that are included via <code>xsl:include</code> into
            the <code>master.xsl</code> stylesheet. Such external files are not handled automatically currently.</p>
        </div>
      </xmlcodeOFF>
      <param name="product" value="editor"/>
      <param name="lang"    value="en"/>
    </target>
  </xmlcode>

  <h2>Standard page definition</h2>
  
  <xmlcode>
    <standardpage name="home"  xml="core/editor/xml/two_frames.xml"/>
    <xmlcodeOFF>
      <div class="comment">
        after performing the transformation <code>depend.xml.in</code> => <code>depend.xml</code>
        (automatically done by the build system in the skeleton package and the CVS checkout) this becomes
      </div>
      <br/>
    </xmlcodeOFF>
    <target name="home.xsl" type="xsl">
      <depxml name="home.xml"/>
      <depxsl name="master.xsl"/>
      <param name="page" value="home"/>
      <param name="docroot" value="/some/absolute/path/to/your/pustefix/projects"/>
    </target><xmlcodeOFF/>
    <target name="home.xml" type="xml">
      <depxml name="core/editor/xml/two_frames.xml"/>
      <depxsl name="metatags.xsl"/>
      <param name="page" value="home"/>
      <param name="docroot" value="/some/absolute/path/to/your/pustefix/projects"/>
    </target>
  </xmlcode>

</div>

  