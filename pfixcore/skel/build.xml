<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE project PUBLIC "-//ANT//DTD project//EN" "ant.dtd">
<!-- ant.dtd is generated by target dtd. This is not done automatically.
     If any problems arise either regenerate ant.dtd by invoking ant dtd
     or delete the DOCTYPE definition -->

<project name="pfixcore_skel" default="all" basedir=".">

    <!-- set global properties for this build -->
    <property file="build.properties"/>
    <property environment="env"/>
    <property name="project.name"             value="${ant.project.name}"/>
    <property name="uid"                      value="${env.USER}"/>
    <property name="build.compiler"           value="jikes"/>
    <property name="build.compiler.emacs"     value="true"/>
    <property name="javac.source"             value="1.4"/>
    <property name="name.jnipkg"              value="jni.tar.gz"/>
    <property name="name.cvsautotag"          value="CVS_AUTOTAG"/>
    <property name="debugopts"                value="-Xdebug -Xnoagent -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5000"/>
    <property name="dir.src"                  location="src"/>
    <property name="dir.build"                location="build"/>
    <property name="dir.lib"                  location="lib"/>
    <property name="dir.res"                  location="res"/>
    <property name="dir.dist"                 location="dist"/>
    <property name="dir.skel"                 location="skel"/>
    <property name="dir.javadoc"              location="apidocs"/>
    <property name="dir.jni"                  location="${dir.lib}/jni"/>
    <property name="dir.metainf"              location="META-INF"/>
    <property name="dir.projects"             location="projects"/>
    <property name="dir.docroot"              location="${dir.projects}"                                        description="document root for tomcat, defaults to dir.projects"/>
    <property name="file.projects_xml"        location="${dir.projects}/servletconf/projects.xml"/>
    <property name="genlog"                   value="quiet"                                                description="which log4j config to use for the generate task; currently one of quiet, full, tree; defaults to quiet; see ${dir.projects}/core/conf/generator_*.xml"/>
    <property name="file.log4jconfig"         location="${dir.projects}/core/conf/generator_${genlog}.xml"/>
    <property name="name.build-include"       value="build-include.xml"/>
    <property name="file.build-include"       location="${name.build-include}"/>

    <property name="pat.pfixcore_jar"         value="pfixcore-*.jar"/>
    <fileset  id="id.fs.pfixcore_jar"         dir="${dir.lib}" includes="pfixcore-*.jar"/>
    <property name="pat.pfixcore_data_tgz"    value="pfixcore-data-*.tar.gz"/>
    <fileset  id="id.fs.pfixcore_data_tgz"    dir="${dir.lib}" includes="${pat.pfixcore_data_tgz}"/>
    
    
    <target name="properties">
        <!-- Ant properties are immutable, the order of definition is:
        - ant commandline via the '-Dparam=value' option
        - file build.properties in java.util.Properties format
        - environment variables, e.g. export makemode=test
        Note: MAKE_MODE environment variable is supported for backwards
        compatibility to make based build process
        -->
        <condition  property="makemode"     value="test">
            <equals arg1="${env.MAKE_MODE}" arg2="test"/>
        </condition>
        <condition  property="makemode"     value="stage">
            <equals arg1="${env.MAKE_MODE}" arg2="stage"/>
        </condition>
        <property       name="makemode"        value="prod"/>

        <condition property="javahome" value="${env.PFX_JAVA_HOME}">
            <isset property="env.PFX_JAVA_HOME"/>
        </condition>
        <condition property="javahome" value="${env.JAVA_HOME}">
            <isset property="env.JAVA_HOME"/>
        </condition>
        <fail message="Property &quot;javahome&quot; not set. This property is used to create projects/servletconf/tomcat/workers.prop. Set environment variable JAVA_HOME to point to the root directory of the Java2 Standard Edition installation you wish to use." unless="javahome"/>
        
        <condition  property="prohibitedit" value="no">
            <equals arg1="${makemode}" arg2="test"/>
        </condition>
        <property       name="prohibitedit" value="yes"/>

        <condition  property="debug"        value="true">
            <equals arg1="${makemode}" arg2="test"/>
        </condition>
        <property       name="debug"        value="false"/>
        <exec outputproperty="machine" executable="hostname" os="Linux"><arg value="-s"/></exec>
        <exec outputproperty="fqdn"    executable="hostname" os="Linux"><arg value="-f"/></exec>
        <!-- Create time stamp in ISO 8601 alike format.
        17th September 2003 11:58:23 formats to AUTO_TAG_2003-09-17-115823 in property -->
        <tstamp><format property="tstamp.autotag" pattern="'AUTO_TAG_'yyyy'-'MM'-'dd'-'HHmmss"/></tstamp>
    </target>

    <path id="cp.classpath">
        <fileset dir="${dir.lib}" includes="*.jar"/>
        <fileset dir="${dir.projects}" includes="servletconf/tomcat/common/lib/servlet.jar"/>
        <pathelement location="${dir.build}"/>
        <pathelement location="${dir.res}"/>
    </path>
    
    <target name="init" depends="properties, core-data">
        <mkdir dir="${dir.build}"/>
        <mkdir dir="${dir.src}"/>
        <echo message="using machine=${machine} fqdn=${fqdn}" level="verbose"/>
        <!-- pathconvert dumps classpath on ant -verbose -->
        <pathconvert property="dev.null" refid="cp.classpath" pathsep="&#013;"/>
    </target>
    
    <target name="noop" description="just prints the name of the project">
        <echo message="${project.name}"/>
    </target>
    
    <target name="echoproperties" depends="properties">
        <echoproperties/>
    </target>
    
    <target name="debug" depends="all" description="builds all and runs tomcat with debugging options">
        <!-- added suspend=n to default debugging option, as without this option
        Ctrl-C would not stop tomcat without leaving java processes hanging around
        suspend=y target VM is to be suspended immediately before the main class is loaded
        suspend=n do not suspend target VM
        see http://java.sun.com/j2se/1.4.2/docs/guide/jpda/conninv.html -->
        <antcall target="_run" inheritall="true">
            <param name="run.debugopts" value="${debugopts}"/>
        </antcall>
    </target>
    
    <target name="run" depends="all" description="builds all and runs tomcat">
        <antcall target="_run" inheritall="true">
            <param name="run.debugopts" value=""/>
        </antcall>
    </target>
    
    <target name="_run">
        <property name="run.debugopts" value=""/>
        <path id="run.path.ld_library_path">
            <pathelement path="${env.LD_LIBRARY_PATH}"/>
            <pathelement location="${dir.jni}/build"/>
        </path>
        <property name="run.ld_library_path" refid="run.path.ld_library_path"/>
        <exec dir="${dir.projects}/servletconf/tomcat" executable="${dir.projects}/servletconf/tomcat/bin/catalina.sh" vmlauncher="false">
            <env key="LD_LIBRARY_PATH" value="${run.ld_library_path}"/>
            <env key="JAVA_OPTS" value="-mx200M ${run.debugopts}"/>
            <env key="JSSE_HOME" value="${basedir}/lib/jsse"/>
            <env key="LANG" value="C"/>
            <arg line="run"/>
        </exec>
    </target>
    
    <target name="generate" depends="targetdefs, stylesheets, compile, installjars, check-permissions" description="Generates Targets to ${dir.projects}/.cache">
        <pfx-generate dir="${dir.projects}" includes="**/depend.xml" log4jconfig="${file.log4jconfig}" excludes="${excludes.projects}"/>
        <echo message="If build dies with an OutOfMemoryException, set and export environment variable ANT_OPTS to something like ANT_OPTS=&quot;-ms200m -mx200m&quot;."/>
        <echo message="As an alternative try target generate-mx, which forks an external java vm with more Heap Memory."/>
    </target>
    
    <target name="generate-mx" depends="targetdefs, stylesheets, compile, installjars, check-permissions" description="Same as generate, but forks an external vm with more Heap Memory.">
        <pathconvert property="generate-mx.configs" pathsep=" ">
            <path>
                <fileset dir="${dir.projects}">
                    <include name="**/depend.xml"/>
                    <exclude name="${excludes.projects}"/>
                </fileset>
            </path>
        </pathconvert>
        <java classname="de.schlund.pfixxml.targets.TargetGenerator" classpathref="cp.classpath" fork="true">
            <arg line="${generate-mx.configs}"/>
            <sysproperty key="log4jconfig" value="${dir.projects}/core/conf/generator_quiet.xml"/>
            <jvmarg value="-ms200M"/>
            <jvmarg value="-mx200M"/>
        </java>
    </target>

    <target name="all" 
        depends="compile, post-compile, installjars, propfiles, targetdefs, web_xml, stylesheets, pfixlog_xml, products_prj, apache_conf, jk_conf, workers_prop, server_xml, statusmessages_xml, check-permissions"
        description="builds all files required to run"
        />
    
    <target name="depend" depends="generate-src, jni" description="checks dependencies of all .java files">
        <depend
            srcdir="${dir.src}"
            destdir="${dir.build}"
            cache="${dir.build}"
            >
        </depend>
    </target>
    
    <target name="build-include-available">
        <available file="${file.build-include}" property="avl.build-include"/>
    </target>

    <target name="clean-build-include" depends="build-include-available" if="avl.build-include">
        <ant antfile="${file.build-include}" target="clean"/>
    </target>
    
    <target name="pre-compile" depends="build-include-available" if="avl.build-include">
        <echo message="Calling target pre-compile in ${name.build-include}"/>
        <ant antfile="${file.build-include}" target="pre-compile"/>
    </target>

    <target name="compile" depends="generate-src, jni, depend, pre-compile" description="compiles all .java files">
        <javac 
            srcdir="${dir.src}"
            destdir="${dir.build}"
            debug="${debug}"
            classpathref="cp.classpath"
            source="${javac.source}"
            excludes="${excludes.src}"
            >
        </javac>
    </target>
    
    <target name="post-compile" depends="build-include-available, compile" if="avl.build-include">
        <echo message="Calling target post-compile in ${name.build-include}"/>
        <ant antfile="${file.build-include}" target="post-compile"/>
    </target>

    <target name="generate-src" depends="ant-tasks" description="generates interfaces wrappers .by transforming .iwrp to .java files">
        <pfx-iwrp srcdir="${dir.src}" includes="**/*.iwrp" destdir="${dir.src}" extension=".java" style="${dir.projects}/core/build/iwrapper.xsl" excludes="${excludes.src}"/>
    </target>
    
    <target name="jni">
        <!-- unjar jni.tar.gz out of pfixcore.jar -->
        <!-- If overwrite="false", unjar overwrites a file if the modification times of the
             target file are older than the modification times of the file contained in the archive. -->
        <unjar dest="${dir.lib}" overwrite="false">
            <fileset refid="id.fs.pfixcore_jar"/>
            <patternset>
                <include name="${name.jnipkg}" />
            </patternset>
        </unjar>
        <untar src="${dir.lib}/${name.jnipkg}" dest="${dir.lib}" compression="gzip" overwrite="false"/>
        <ant dir="${dir.jni}"/>
    </target>

    <target name="clean-jni">
        <ant dir="${dir.jni}" target="clean"/>
    </target>
    
    <target name="installjars">
        <!-- Setting absolute links instead of relative to avoid extra property for dir.build 
        as ${dir.build} is specified as location it always resolves to an absolute path;
        does not work for filenames containing spaces -->
        <echo level="verbose" message="Setting symlink to ${dir.build} as ${dir.projects}/servletconf/tomcat/classes"/>
        <exec executable="sh">
            <arg line="-c &quot;[ -d ${dir.projects}/servletconf/tomcat/classes -a ! -L ${dir.projects}/servletconf/tomcat/classes ] &amp;&amp; rm -fr ${dir.projects}/servletconf/tomcat/classes ; [ ! -L ${dir.projects}/servletconf/tomcat/classes ] &amp;&amp; ln -s  ${dir.build} ${dir.projects}/servletconf/tomcat/classes || true&quot;"/>
        </exec>
        <!-- as task delete does not delete symbolic links, deleting symlinks using native tools -->
        <!-- only deleting symlinks pointing to non existent files, assuming jar files -->
        <!-- replaced by new versions (with a new filenames) do not exist anymore -->
        <exec executable="find" os="Linux">
            <arg file="${dir.projects}/servletconf/tomcat/lib"/>
            <arg line="-iname *.jar -a -type l -a -xtype f -exec rm {} ;"/>
        </exec>
        <!-- don't delete the *-res.jar file here, let it be updated by task jar -->
        <echo level="verbose">Building ${project.name}-res.jar in tomcat's lib directory</echo>
        <jar jarfile="${dir.projects}/servletconf/tomcat/lib/${project.name}-res.jar">
            <fileset dir="${basedir}" includes="META-INF/**"/>
            <fileset dir="${dir.res}"/>
        </jar>
        <echo level="verbose">Creating symlinks in tomcat's lib directory</echo>
        <exec executable="sh">
            <arg line="-c &quot;cd ${dir.projects}/servletconf/tomcat/lib &amp;&amp; for i in ${dir.lib}/*.jar ; do test -L $(basename $i) || ln -s $i . ; done&quot;"/>
        </exec>
    </target>
    
    <target name="ant-tasks" depends="init" description="declares the ant task used for generating java source code. This target needs to be run prior to the actual compile.">
        <taskdef
            name="pfx-xslt"
            classname="de.schlund.pfixcore.util.XsltGenericTask"
            classpathref="cp.classpath"
            description="Performs generic XSLT transformations"
            />
        <taskdef 
            name="pfx-iwrp"
            classname="de.schlund.pfixcore.util.XsltIWrapperTask"
            classpathref="cp.classpath"
            description="Generates .java files out of .iwrp (Interface Wrapper) files"
            />
        <taskdef
            name="pfx-webxml"
            classname="de.schlund.pfixcore.util.XsltWebXmlTask"
            classpathref="cp.classpath"
            description="Creates WEB-INF/web.xml config files for each project"
            />
        <taskdef
            name="pfx-generate"
            classname="de.schlund.pfixcore.util.TargetGeneratorTask"
            classpathref="cp.classpath"
            description="Creates dependencies in ${dir.projects}/.cache"
            />
    </target>
    
    <target name="dtd" depends="dtd-check, ant-tasks" unless="upd.dtd" description="Creates a DTD for this build file.">
        <!-- DTD generated does not describe this build file thorough. It can't be used 
             for complete validation though it may be useful for auto competion within IDEs.
             The Element not generated is the nested type "param" used within the custom ant-tasks -->
        <echo message="Creating ant.dtd" level="info"/>
        <antstructure output="ant.dtd"/>
    </target>
    
    <target name="dtd-check" unless="pfx.force">
        <uptodate property="upd.dtd" srcfile="build.xml" targetfile="ant.dtd"/>
    </target>
    
    <target name="clean-dtd">
        <delete file="ant.dtd"/>
    </target>

    <target name="clean" depends="clean-project, clean-build-include" description="deletes ${dir.build}, ${dir.dist} directory trees and all .java files generated from .iwrp files in ${dir.src}">
        <!-- Delete ${dir.build}, ${dir.dist} directory trees and all .java files generated from .iwrp files in ${dir.src} -->
        <delete dir="${dir.build}"/>
        <delete dir="${dir.dist}"/>
        <!-- Delete *.java files created from *.iwrp files -->
        <delete>
            <fileset dir="${dir.src}" includes="**/*.java">
                <present present="both" targetdir="${dir.src}">
                    <mapper type="glob" from="*.java" to="*.iwrp"/>
                </present>
            </fileset>
        </delete>
        <!-- as task delete does not delete symbolic links, deleting symlinks using native tools -->
        <exec executable="find" os="Linux">
            <arg file="${dir.projects}/servletconf/tomcat"/> <!-- symlink classes -->
            <arg file="${dir.projects}/servletconf/tomcat/lib"/> <!-- symlinks *.jar -->
            <arg line="-type l -maxdepth 1 -exec rm {} ;"/>
        </exec>
        <!-- delete regular files using task delete -->
        <delete>
            <fileset dir="${dir.projects}/servletconf/tomcat/lib" includes="*.jar"/>
        </delete>
        <delete file="${dir.metainf}/${name.cvsautotag}"/>
    </target>
    
    <target name="clean-project" description="deletes files from ${dir.projects}">
        <!-- Delete ${dir.build}, ${dir.dist} directory trees and all .java files generated from .iwrp files in ${dir.src} -->
        <delete>
            <fileset dir="${dir.projects}" includes="**/*.xsl">
                <present present="both" targetdir="${dir.projects}">
                    <mapper type="glob" from="*.xsl" to="*.xsl.in"/>
                </present>
            </fileset>
            <fileset dir="${dir.projects}" includes="**/depend.xml">
                <present present="both" targetdir="${dir.projects}">
                    <mapper type="glob" from="*depend.xml" to="*depend.xml.in"/>
                </present>
            </fileset>
            <fileset dir="${dir.projects}" includes="**/*.prop">
                <present present="both" targetdir="${dir.projects}">
                    <mapper type="glob" from="*.prop" to="*.prop.in"/>
                </present>
            </fileset>
            <fileset dir="${dir.projects}" includes="common/conf/products.prj common/conf/pfixlog.xml servletconf/projects.xml servletconf/tomcat/apache.conf servletconf/tomcat/jk.conf servletconf/tomcat/workers.prop servletconf/tomcat/conf/server.xml"/>            
        </delete>
        <delete dir="${dir.projects}/servletconf/tomcat/webapps"/>
    </target>
    
    <target name="realclean" depends="clean, clean-jni">
        <delete dir="${dir.projects}/.cache"/>
    </target>

    <target name="core-data-check" unless="pfx.force">
        <!-- extract only if pfixcore-data.jar is newer than dir ${dir.projects}/core -->
        <uptodate property="upd.core-data">
            <srcfiles dir="${dir.lib}" includes="${pat.pfixcore_data_tgz}"></srcfiles>
            <mapper type="merge" to="${dir.projects}/core"></mapper>
        </uptodate>
    </target>
    
    <target name="core-data" depends="core-data-check" unless="upd.core-data">
        <delete dir="${dir.projects}/core"/>
        <untar dest="${dir.projects}" compression="gzip" overwrite="true">
            <fileset refid="id.fs.pfixcore_data_tgz"/>
        </untar>
    </target>
    
    <target name="check-permissions">
        <apply executable="chmod" os="Linux">
            <arg line="a+x"/>
            <fileset dir="${basedir}" includes="apploader.sh startTomcat.sh bin/setClassPath.sh projects/bin/setvars.sh projects/servletconf/tomcat/bin/catalina.sh projects/servletconf/tomcat/bin/setclasspath.sh"/>
        </apply>
    </target>
    
    <target name="force" description="disables uptodate checks">
        <!-- All targets *-check that have set the attribute unless="pfx.force"
             will be skipped, so the uptodate properties (upd.*), the execution of the actual tasks
             depends on, do not get set and in turn the actual tasks get executed. -->
        <property name="pfx.force" value="true"/>
    </target>
    
    <target name="checkfiles">
        <!-- find the input files and write them to line separated files -->
        <pathconvert property="checkfiles.ALLPROJECTS" pathsep="&#10;">
            <path>
                <fileset dir="${dir.projects}">
                    <include name="**/depend.xml"/>
                </fileset>
            </path>
            <map from="${dir.projects}/" to=""/>
        </pathconvert>
        <echo message="${checkfiles.ALLPROJECTS}" file="${dir.projects}/.ALLPROJECTS"/>
        <pathconvert property="checkfiles.ALLINCFILES" pathsep="&#10;">
            <path>
                <fileset dir="${dir.projects}" casesensitive="false">
                    <include name="**/txt/**/*.xml"/>
                </fileset>
            </path>
            <map from="${dir.projects}/" to=""/>
        </pathconvert>
        <echo message="${checkfiles.ALLINCFILES}" file="${dir.projects}/.ALLINCFILES"/>
        <pathconvert property="checkfiles.ALLIMAGES" pathsep="&#10;">
            <path>
                <fileset dir="${dir.projects}" casesensitive="false">
                    <include name="**/img/**/*.gif" />
                    <include name="**/img/**/*.jp*g"/>
                </fileset>
            </path>
            <map from="${dir.projects}/" to=""/>
        </pathconvert>
        <echo message="${checkfiles.ALLIMAGES}" file="${dir.projects}/.ALLIMAGES"/>
        <!-- we must fork a java vm here to set the current dir -->
        <java
            classname="de.schlund.pfixcore.util.CheckIncludes"
            classpathref="cp.classpath"
            dir="${dir.projects}"
            fork="true"
            failonerror="true"
            >
            <arg file="${dir.projects}/CHECKOUTPUT.xml"/>
            <arg file="${dir.projects}/.ALLPROJECTS"/>
            <arg file="${dir.projects}/.ALLINCFILES"/>
            <arg file="${dir.projects}/.ALLIMAGES"/>
        </java>
        <echo message="Output written to ${dir.projects}/CHECKOUTPUT.xml" level="info"/>
    </target>    

    <target name="propfiles" depends="ant-tasks" description="creates **/*.prop">
        <pfx-xslt 
            style="${dir.projects}/core/build/create_propfiles.xsl"
            srcdir="${dir.projects}"
            destdir="${dir.projects}"
            includes="**/*.prop.in"
            extension=""
            >
            <param name="docroot" expression="${dir.docroot}"/>
            <param name="fqdn"    expression="${fqdn}"/>
            <param name="uid"     expression="${uid}"/>
            <param name="machine" expression="${machine}"/>
            <param name="mode"    expression="${makemode}"/>
        </pfx-xslt>
    </target>

    <target name="targetdefs" depends="ant-tasks" description="creates **/depend.xml">
        <pfx-xslt 
            style="${dir.projects}/core/build/create_depend.xsl"
            srcdir="${dir.projects}"
            destdir="${dir.projects}"
            includes="**/depend.xml.in"
            extension=""
            >
            <param name="prohibitEdit" expression="${prohibitedit}"/>
            <param name="docroot" expression="${dir.docroot}"/>
        </pfx-xslt>
    </target>
    
    <target name="projects_xml" depends="ant-tasks" description="creates projects.xml out of projects.xml.in and multiple project.xml files" >
        <fileset id="id.fileset.projectxmlin" dir="${dir.projects}" includes="**/project.xml.in"/>
        <pathconvert property="projectxmlins" refid="id.fileset.projectxmlin" pathsep="|">
            <map from="${dir.projects}/" to=""/>
        </pathconvert>
        <echo level="verbose" message="**/project.xml.in matches ${projectxmlins}"/>
        <dependset>
            <srcfileset refid="id.fileset.projectxmlin"/>
            <targetfileset dir="${dir.projects}/servletconf" includes="projects.xml"/>
        </dependset>
        <pfx-xslt
            style="${dir.projects}/core/build/create_projects.xsl"
            srcdir="${dir.projects}"
            destdir="${dir.projects}"
            includes="servletconf/projects.xml.in"
            >
            <param name="docroot" expression="${dir.docroot}"/>
            <param name="files"   expression="${projectxmlins}"/>
        </pfx-xslt>
    </target>

    <target name="web_xml" depends="ant-tasks, projects_xml" description="creates servletconf/tomcat/webapps/**/WEB-INF/web.xml">
        <!-- old target name in Makefile was "zoneprops" -->
        <pfx-webxml
            style="${dir.projects}/core/build/create_tomcatweb.xsl"
            srcdir="${dir.projects}"
            destdir="${dir.projects}/servletconf/tomcat"
            includes="servletconf/projects.xml"
            extension=".xml"
            >
            <param name="docroot" expression="${dir.docroot}"/>
            <param name="fqdn"    expression="${fqdn}"/>
            <param name="uid"     expression="${uid}"/>
            <param name="machine" expression="${machine}"/>
            <param name="mode"    expression="${makemode}"/>
        </pfx-webxml>
    </target>
    
    <target name="stylesheets" depends="ant-tasks" description="creates **/*.xsl from **/*.xsl.in with create_stylesheet.xsl">
        <pfx-xslt
            style="${dir.projects}/core/build/create_stylesheet.xsl"
            srcdir="${dir.projects}"
            destdir="${dir.projects}"
            includes="**/*.xsl.in"
            extension=""
            >
            <param name="docroot" expression="${dir.docroot}"/>
            <param name="fqdn"    expression="${fqdn}"/>
            <param name="uid"     expression="${uid}"/>
            <param name="machine" expression="${machine}"/>
            <param name="mode"    expression="${makemode}"/>
        </pfx-xslt>
    </target>
    
    <target name="statusmessages_xml" depends="compile, propfiles" description="creates common/dyntxt/statusmessages.xml">
        <java classname="de.schlund.pfixcore.util.MakeStatusMessageXML">
            <sysproperty key="propertyfile" value="${dir.projects}/common/conf/factory.prop"/>
            <arg value="${dir.projects}/common/dyntxt/statusmessages.xml"/>
            <classpath refid="cp.classpath"/>
        </java>
    </target>

    <target name="pfixlog_xml" depends="ant-tasks" description="creates common/conf/pfixlog.xml from common/conf/pfixlog.xml.in with core/build/create_log4j_config.xsl">
        <pfx-xslt
            style="${dir.projects}/core/build/create_log4j_config.xsl"
            srcdir="${dir.projects}"
            destdir="${dir.projects}"
            includes="common/conf/pfixlog.xml.in"
            extension=""
            >
            <param name="docroot" expression="${dir.docroot}"/>
            <param name="fqdn"    expression="${fqdn}"/>
            <param name="uid"     expression="${uid}"/>
            <param name="machine" expression="${machine}"/>
            <param name="mode"    expression="${makemode}"/>
        </pfx-xslt>
    </target>
    
    <target name="products_prj" depends="ant-tasks, projects_xml" description="creates common/conf/products.prj from servletconf/projects.xml with core/build/create_products.xsl">
        <pfx-xslt
            infile="${dir.projects}/servletconf/projects.xml"
            outfile="${dir.projects}/common/conf/products.prj"
            style="${dir.projects}/core/build/create_products.xsl"
            >
            <param name="docroot"   expression="${dir.docroot}"/>
            <param name="fqdn"      expression="${fqdn}"/>
            <param name="uid"       expression="${uid}"/>
            <param name="machine"   expression="${machine}"/>
            <param name="mode"      expression="${makemode}"/>
            <param name="container" expression="tomcat"/>
        </pfx-xslt>
    </target>

    <target name="apache_conf" depends="ant-tasks, projects_xml" description="creates common/conf/products.prj from servletconf/projects.xml with core/build/create_apacheconf.xsl">
        <pfx-xslt
            infile="${dir.projects}/servletconf/projects.xml"
            outfile="${dir.projects}/servletconf/tomcat/apache.conf"
            style="${dir.projects}/core/build/create_apacheconf.xsl"
            >
            <param name="docroot"   expression="${dir.docroot}"/>
            <param name="fqdn"      expression="${fqdn}"/>
            <param name="uid"       expression="${uid}"/>
            <param name="machine"   expression="${machine}"/>
            <param name="mode"      expression="${makemode}"/>
            <param name="container" expression="tomcat"/>
        </pfx-xslt>
    </target>

    <target name="jk_conf" depends="ant-tasks, projects_xml" description="creates servletconf/tomcat/jk.conf from servletconf/projects.xml with core/build/create_jkconf.xsl">
        <pfx-xslt
            infile="${dir.projects}/servletconf/projects.xml"
            outfile="${dir.projects}/servletconf/tomcat/jk.conf"
            style="${dir.projects}/core/build/create_jkconf.xsl"
            >
            <param name="docroot"   expression="${dir.docroot}"/>
            <param name="fqdn"      expression="${fqdn}"/>
            <param name="uid"       expression="${uid}"/>
            <param name="machine"   expression="${machine}"/>
            <param name="mode"      expression="${makemode}"/>
            <param name="container" expression="tomcat"/>
        </pfx-xslt>
    </target>
    
    <target name="workers_prop" depends="ant-tasks, projects_xml" description="creates servletconf/tomcat/workers.prop from servletconf/projects.xml with core/build/create_workersprop.xsl">
        <pfx-xslt
            infile="${dir.projects}/servletconf/projects.xml"
            outfile="${dir.projects}/servletconf/tomcat/workers.prop"
            style="${dir.projects}/core/build/create_workersprop.xsl"
            >
            <param name="docroot"   expression="${dir.docroot}"/>
            <param name="fqdn"      expression="${fqdn}"/>
            <param name="uid"       expression="${uid}"/>
            <param name="machine"   expression="${machine}"/>
            <param name="mode"      expression="${makemode}"/>
            <param name="java_home" expression="${javahome}"/>
            <param name="container" expression="tomcat"/>
        </pfx-xslt>
    </target>
    
    <target name="server_xml" depends="ant-tasks, projects_xml" description="creates servletconf/tomcat/conf/server.xml from servletconf/projects.xml with core/build/create_serverxml.xsl">
        <pfx-xslt
            infile="${dir.projects}/servletconf/projects.xml"
            outfile="${dir.projects}/servletconf/tomcat/conf/server.xml"
            style="${dir.projects}/core/build/create_serverxml.xsl"
            >
            <param name="docroot"   expression="${dir.docroot}"/>
            <param name="fqdn"      expression="${fqdn}"/>
            <param name="uid"       expression="${uid}"/>
            <param name="machine"   expression="${machine}"/>
            <param name="mode"      expression="${makemode}"/>
            <param name="container" expression="tomcat"/>
        </pfx-xslt>
    </target>

</project>

<!-- Cut 'n' Paste "Buffer"
-->



<!--
Local Variables:
sgml-indent-step: 4
End:
-->
