<?xml version="1.0" encoding="ISO-8859-1" ?>

<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/"
                     xmlns:cus="http://www.schlund.de/pustefix/customize">

  <appender name="PFXPERF" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-pfxperf.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601}|%m\n"/>
    </layout>
  </appender>

  <appender name="LOGGER_GENERAL" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-servlet.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <cus:choose>
        <cus:test uid="jtl">
          <param name="ConversionPattern" value="%-5p %c [%M():%L] %m\n"/>
        </cus:test>
        <cus:test>
          <param name="ConversionPattern" value="%d{ISO8601} [%t] %-5p %c [%M():%L] %x - %m\n"/>
        </cus:test>
      </cus:choose>
    </layout>
  </appender>

  <appender name="LOGGER_JMX" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-jmx.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601} [%t] %-5p %c [%M():%L] %x - %m\n"/>
    </layout>
  </appender>
  
  <appender name="LOGGER_TRAIL" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-trail.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601}|%m\n"/>
    </layout>
  </appender>
  
  <appender name="LOGGER_VISIT" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-visit.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601}|%m\n"/>
    </layout>
  </appender>

  <appender name="LOGGER_EDITOR" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-editor.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601} %c [%M():%L] - %m\n"/>
    </layout>
  </appender>

  <appender name="LOGGER_SERIALIZER" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-serializer.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601} %m\n"/>
    </layout>
  </appender>

  <appender name="LOGGER_PROFILER" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-profiling.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%m|%d{ISO8601}\n"/>
    </layout>
  </appender>

  <appender name="LOGGER_DEREF" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-deref.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601}|%m\n"/>
    </layout>
  </appender>

  <appender name="LOGGER_APPLOADER" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-apploader.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601} %m\n"/>
    </layout>
  </appender>

  <appender name="LOGGER_WEBSERVICE" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-webservice.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601} %m\n"/>
    </layout>
  </appender>

  <appender name="LOGGER_EDITOR_PERF" class="org.apache.log4j.RollingFileAppender">
    <param name="File"><cus:docroot/>servletconf/log/pustefix-editor-perf.log</param>
    <param name="MaxFileSize" value="10MB"/>
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%d{ISO8601} %m\n"/>
    </layout>
  </appender>
 
  <!-- Categories -->

  <!-- make some classes quiet by default --> 
  <category name="PFXPERF" additivity="false">
    <priority value="ERROR"/>
    <appender-ref ref="PFXPERF"/>
  </category>

  <category name="EDITOR_PERF" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_EDITOR_PERF"/>
  </category>
  
  <category name="de.schlund.pfixcore.workflow.app.RequestDataImpl" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.util.statuscodes.StatusCodeFactory" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.FactoryInitServlet" additivity="false">
    <priority value="DEBUG"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.targets" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.ServletManager" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.AbstractXMLServer" additivity="false">
    <priority value="DEBUG"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixcore.workflow.Context" additivity="false">
    <priority value="DEBUG"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixcore.workflow.AuthContext" additivity="false">
    <priority value="DEBUG"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.SessionCleaner" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.PfixServletRequest" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.XMLServer" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.IncludeDocument" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>
  
  <category name="de.schlund.pfixxml.IncludeDocumentExtension" additivity="false">
    <priority value="DEBUG"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.exceptionhandler" additivity="false">
    <priority value="INFO"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>
  
  <category name="de.schlund.pfixxml.targets.TraxXSLTProcessor" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>
  
  <category name="de.schlund.pfixxml.loader" additivity="false">
    <priority value="INFO"/>
    <appender-ref ref="LOGGER_APPLOADER"/>
  </category>
  
  <category name="de.schlund.pfixxml.perflogging" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="PFXPERF"/>
  </category>

  
  <category name="de.schlund.pfixcore.webservice" additivity="false">
    <cus:choose>
      <cus:test mode="prod">
        <priority value="WARN"/>
      </cus:test>
      <cus:test>
        <priority value="DEBUG"/>
      </cus:test>
    </cus:choose>
    <appender-ref ref="LOGGER_WEBSERVICE"/>
  </category>
  
  <category name="org.apache.axis" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>
 
  <!-- Newer commons-logging versions might slow down tomcat startup enormously due to excessive
       Digester logging while reading XML configurations - to be on the safe side the priority is
       set to ERROR here
  -->
  <category name="org.apache.commons.digester.Digester" additivity="false">
    <priority value="ERROR"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>

  <category name="de.schlund.pfixxml.DependencyTracker" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_GENERAL"/>
  </category>
  
  <!-- special categories for additional logfiles -->
  
  <category name="LOGGER_VISIT" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_VISIT"/>
  </category>
  
  <category name="LOGGER_TRAIL" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_TRAIL"/>
  </category>

  <category name="LOGGER_EDITOR" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_EDITOR"/>
  </category>

  <category name="de.schlund.pfixcore.editor" additivity="false">
   <priority value="DEBUG"/>
   <appender-ref ref="LOGGER_EDITOR"/>
  </category>
  
  <category name="LOGGER_SERIALIZER" additivity="false">
    <priority value="DEBUG"/>
    <appender-ref ref="LOGGER_SERIALIZER"/>
  </category>

  <category name="LOGGER_PROFILER" additivity="false">
    <priority value="ERROR"/>
    <appender-ref ref="LOGGER_PROFILER"/>
  </category>

  <category name="LOGGER_DEREF" additivity="false">
    <priority value="WARN"/>
    <appender-ref ref="LOGGER_DEREF"/>
  </category>

  <category name="de.schlund.pfixxml.jmx" additivity="false">
    <priority value="DEBUG"/>
    <appender-ref ref="LOGGER_JMX"/>
  </category>

  <!-- default category -->

  <root>
    <cus:choose>
      <cus:test uid="jtl">
        <priority value="DEBUG"/>
      </cus:test>
      <cus:test mode="prod">
        <priority value="WARN"/>
      </cus:test>
      <cus:test>
        <priority value="DEBUG"/>
      </cus:test>
    </cus:choose>
    <appender-ref ref="LOGGER_GENERAL"/>
  </root>
  
</log4j:configuration>
