<?xml version="1.0" encoding="ISO-8859-1"?>
<include_parts xmlns:pfx="http://www.schlund.de/pustefix/core"
               xmlns:ixsl="http://www.w3.org/1999/XSL/Transform">
  
  <part name="content">
    <product name="default">
      <lang name="default">
        <center>
          <pfx:checkerror>
            <pfx:checkfield name="imgsel.Path">
              <pfx:error>
                <br/>
                <table class="core_errorbox_table" width="400">
                  <tr>
                    <td class="core_errorlabel_text">
                      Error!
                    </td>
                    <td class="core_errortext">
                      <pfx:scode/>
                    </td>
                  </tr>
                </table>
              </pfx:error>
            </pfx:checkfield>
            <pfx:checkfield name="upload.ImageFile">
              <pfx:error>
                <table class="core_errorbox_table" width="400">
                  <tr>
                    <td class="core_errorlabel_text">
                      Error!
                    </td>
                    <td class="core_errortext">
                      <pfx:scode/>
                    </td>
                  </tr>
                </table>                
              </pfx:error>
            </pfx:checkfield>
          </pfx:checkerror>
        </center>
        <ixsl:choose>
          <ixsl:when test="/formresult/images/currentimage">
            <pfx:include part="displaycurrentimage"/>
            <pfx:include part="displayimagedetails"/>
            <ixsl:for-each select="/formresult/images/currentimage/pages">
              <pfx:include part="displayaffectedpages" href="core/editor2/txt/util.xml"/>
            </ixsl:for-each>
            <!--
            <displaycurrentimage/><br/>
            <displayimagedetails/>
            <displayaffectedpages path="/formresult/currentimageinfo"/>
            -->
          </ixsl:when>
          <ixsl:otherwise>
            <center>
              <br/>
              <div class="editor_main_emph">
                Please select an image from the list on the left
              </div>
            </center>
          </ixsl:otherwise>
        </ixsl:choose>
      </lang>
    </product>
  </part>

  <part name="sidebar">
    <product name="default">
      <lang name="default">
        <pfx:include part="displayallimages"/>
      </lang>
    </product>
  </part>

  <part name="displayallimages">
    <product name="default">
      <lang name="default">
        <table width="100%" class="editor_sidebar_content">
          <ixsl:for-each select="/formresult/images/directory">
            <tr>
              <td class="editor_sidebar_box" nowrap="nowrap">
                Directory: <b><ixsl:value-of select="@path"/></b>
              </td>
            </tr>
            <ixsl:for-each select="./image">
              <tr>
                <td nowrap="nowrap">
                  <ixsl:if test="@selected='true'">
                    <ixsl:attribute name="class">editor_sidebar_content_sel</ixsl:attribute>
                  </ixsl:if>
                  <a>
                    <ixsl:attribute name="name"><ixsl:value-of select="./@path"/></ixsl:attribute>
                  </a>
                  <ixsl:if test="@missing = 'true'"><span class="editor_missing_img">!&#160;</span></ixsl:if>
                  <pfx:button page="images" frame="_top" target="_top" mode="force">
                    <pfx:command  name="SELWRP">selectimage</pfx:command>
                    <pfx:argument name="selectimage.Path"><ixsl:value-of select="./@path"/></pfx:argument>
                    <pfx:anchor   frame="left_navi"><ixsl:value-of select="./@path"/></pfx:anchor>
                    <ixsl:value-of select="@filename"/>
                  </pfx:button>
                </td>
              </tr>
            </ixsl:for-each>
            <ixsl:if test="following-sibling::directory">
              <tr>
                <td><blank style="display:block;" height="5px"/></td>
              </tr>
            </ixsl:if>
          </ixsl:for-each>
        </table>
      </lang>
    </product>
  </part>
  
  <part name="displaycurrentimage">
    <product name="default">
      <lang name="default">
        <div class="editor_main_emph" align="right">
          [IMAGE: <ixsl:value-of select="/formresult/images/currentimage/@filename"/>]
        </div>
        <br/>
      </lang>
    </product>
  </part>
  
  <part name="displayimagedetails">
    <product name="default">
      <lang name="default">
        <pfx:forminput enctype="multipart/form-data">
          <pfx:xinp type="hidden" name="__anchor">
            <ixsl:attribute name="value">left_navi|<ixsl:value-of select="/formresult/currentimageinfo/@path"/></ixsl:attribute>
          </pfx:xinp>
          <table width="100%">
            <tr>
              <td nowrap="nowrap" class="editor_main_emph">Current image: <ixsl:value-of select="/formresult/images/currentimage/@path"/>
              </td>
            </tr>
          </table>
          <ixsl:choose>
            <ixsl:when test="/formresult/images/currentimage/@mayEdit = 'true'">
              <table width="100%" class="editor_box_alpha" cellspacing="0" background="/core/editor/img/alpha.gif">
                <tr>
                  <td align="center" style="padding-top: 10px; padding-bottom: 10px;" colspan="3">
                    <ixsl:choose>
                      <ixsl:when test="/formresult/images/currentimage/@modtime = 0">
                        <span class="editor_missing_img_txt">MISSING IMAGE</span>
                      </ixsl:when>
                      <ixsl:otherwise>
                        <img border="0">
                          <ixsl:attribute name="src">/<ixsl:value-of select="/formresult/images/currentimage/@path"/>?<ixsl:value-of select="/formresult/images/currentimage/@modtime"/></ixsl:attribute>
                        </img>
                      </ixsl:otherwise>
                    </ixsl:choose>
                  </td>
                </tr>
                <pfx:include part="uploadimage"/>
              </table>
            </ixsl:when>
            <ixsl:otherwise>
              <pfx:include part="perm_denied_usedby_other_prods" href="core/editor2/txt/util.xml"/>
            </ixsl:otherwise>
          </ixsl:choose>
        </pfx:forminput>
      </lang>
    </product>
  </part>
  
  <part name="uploadimage">
    <product name="default">
      <lang name="default">
        <tr valign="center" class="editor_odd_row">
          <td align="right">
            <pfx:label name="upload.HaveUpload">New Image:</pfx:label>
          </td>
          <td>
            <input type="hidden" name="upload.LastModTime">
              <ixsl:attribute name="value"><ixsl:value-of select="/formresult/images/currentimage/@modtime"/></ixsl:attribute>
            </input>
            <input type="file" name="upload.ImageFile"/>
          </td>
          <td align="right">
            <pfx:xinp class="editor_submit" type="submit" value="Upload Image">
              <pfx:command  name="SELWRP">upload</pfx:command>
            </pfx:xinp>
          </td>
        </tr>
        <!-- TODO Handle backup -->
        <!--
        <ixsl:if test="/formresult/currentimageinfo/backup/option">
          <tr class="editor_odd_row">
            <td colspan="3" align="right" nowrap="nowrap">
              <pfx:xinp type="dynselect" name="upload.Backup" optionpath="/formresult/currentimageinfo/backup"/>
              <pfx:xinp class="editor_submit" type="submit" value="Use Backup">
                <pfx:command  name="SELWRP">upload</pfx:command>
                <pfx:argument name="upload.HaveUpload">true</pfx:argument>
                <pfx:argument name="upload.HaveBackup">true</pfx:argument>
              </pfx:xinp>
            </td>
          </tr>
        </ixsl:if>
        -->
      </lang>
    </product>
  </part>
  
</include_parts>

<!--
Local Variables:
mode: xml
End:
-->
