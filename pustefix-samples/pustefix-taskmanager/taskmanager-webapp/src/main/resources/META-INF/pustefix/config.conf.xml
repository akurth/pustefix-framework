<?xml version="1.0" encoding="UTF-8"?>
<context-xml-service-config xmlns="http://www.pustefix-framework.org/2008/namespace/context-xml-service-config" 
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                    xsi:schemaLocation="http://www.pustefix-framework.org/2008/namespace/context-xml-service-config ../../core/schema/context-xml-service-config.xsd"
                    version="1.0">

  <global-config>
    <!-- <defaultstate class="de.schlund.pfixcore.example.DefaultStaticState" parent-bean-ref="default_state"/> -->
    <!-- <force-ssl>true</force-ssl> -->
  </global-config>

  <context defaultpage="TaskListOverview">
    
  </context>

<!--
  <role name="ANONYMOUS" initial="true"/>
  <role name="AUTHORIZED"/>
-->
  <extension-point type="context.role" id="roles.main"/>
  <extension-point type="context.authconstraint" id="authconstraints.main"/>

  <pageflow name="TaskListFlow" final="TaskListOverview">
      <flowstep name="TaskListOverview"/>
      <flowstep name="TaskOverview"/>
  </pageflow>

  <pageflow name="EditTaskListFlow" final="TaskOverview">
    <flowstep name="EditTaskList"/>
  </pageflow>
  
  <pageflow name="CreateTaskListFlow" final="TaskListOverview">
    <flowstep name="CreateTaskList"/>
  </pageflow>
  
  <pageflow name="EditTaskFlow" final="TaskOverview">
    <flowstep name="EditTask"/>
  </pageflow>
  
  <pageflow name="CreateTaskFlow" final="TaskOverview">
    <flowstep name="CreateTask"/>
  </pageflow>

  <extension-point type="context.pagerequest" id="pagerequest.main"/>

  <pagerequest name="TaskListOverview">
     <authconstraint ref="AC_AUTHORIZED"/>
     <input>
        <wrapper prefix="select" class="org.pustefixframework.samples.taskmanager.web.SelectTaskList"/>
        <wrapper prefix="delete" class="org.pustefixframework.samples.taskmanager.web.DeleteTaskList"/>
     </input>
     <process>
        <action name="select" jumptopage="TaskOverview">
           <submit>
             <wrapper ref="select"/>
           </submit>
        </action>
        <action name="delete">
           <submit>
             <wrapper ref="delete"/>
           </submit>
        </action>
     </process>
     <output>
        <resource node="user" bean-ref="contextUser"/>
        <resource node="tasklists" bean-ref="contextTaskLists"/>
    </output>
  </pagerequest>

  <pagerequest name="CreateTaskList">
     <input>
        <wrapper prefix="create" class="org.pustefixframework.samples.taskmanager.web.CreateTaskList"/>
     </input>
  </pagerequest>

  <pagerequest name="TaskOverview">
    <input>
      <wrapper prefix="select" class="org.pustefixframework.samples.taskmanager.web.SelectTask"/>
      <wrapper prefix="delete" class="org.pustefixframework.samples.taskmanager.web.DeleteTask"/>
    </input>
    <process>
        <action name="select" jumptopage="EditTask">
           <submit>
             <wrapper ref="select"/>
           </submit>
        </action>
        <action name="delete">
           <submit>
             <wrapper ref="delete"/>
           </submit>
        </action>
     </process>
     <output>
       <resource node="tasks" bean-ref="contextTasks"/>
     </output>
  </pagerequest>
  
  <pagerequest name="TaskDetails">
  
  </pagerequest>
  
  <pagerequest name="EditTaskList">
    <input>
      <wrapper prefix="edit" class="org.pustefixframework.samples.taskmanager.web.EditTaskList"/>
    </input>
  </pagerequest>
  
  <pagerequest name="CreateTask">
     <input>
        <wrapper prefix="create" class="org.pustefixframework.samples.taskmanager.web.CreateTask"/>
     </input>
  </pagerequest>
  
  <pagerequest name="EditTask">
     <input>
        <wrapper prefix="create" class="org.pustefixframework.samples.taskmanager.web.EditTask"/>
     </input>
  </pagerequest>

</context-xml-service-config>
